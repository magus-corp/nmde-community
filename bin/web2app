#!/bin/bash
#
# Creates a desktop launcher for a web application.
#
# This script generates a .desktop file, downloads an icon, and makes the
# launcher available in the system's application menu.
#
# Usage: web2app <AppName> <AppURL> <IconURL>
# Example: web2app "My-App" "https://app.example.com" "https://icon.example.com/icon.png"

set -euo pipefail

if [ "$#" -ne 3 ]; then
  echo "Usage: web2app <AppName> <AppURL> <IconURL>"
  echo "IconURL should be a direct link to a PNG file."
  echo "A good source for icons is https://dashboardicons.com"
  exit 1
fi

APP_NAME="$1"
APP_URL="$2"
ICON_URL="$3"

APP_DIR="$HOME/.local/share/applications"
ICON_DIR="$APP_DIR/icons"
DESKTOP_FILE="$APP_DIR/${APP_NAME}.desktop"
ICON_PATH="${ICON_DIR}/${APP_NAME}.png"

# Ensure directories exist
mkdir -p "$APP_DIR"
mkdir -p "$ICON_DIR"

echo "Downloading icon from $ICON_URL..."
if ! curl -sL -o "$ICON_PATH" "$ICON_URL"; then
  echo "Error: Failed to download the icon. Please check the URL."
  exit 1
fi

echo "Creating desktop file at $DESKTOP_FILE..."
cat > "$DESKTOP_FILE" <<EOF
[Desktop Entry]
Version=1.0
Name=$APP_NAME
Comment=A web application for $APP_NAME
Exec=chromium --new-window --ozone-platform=wayland --app="$APP_URL" --name="$APP_NAME" --class="$APP_NAME"
Terminal=false
Type=Application
Icon=$ICON_PATH
StartupNotify=true
Categories=Web;WebApp;
EOF

# Make the desktop file executable to ensure it's recognized
chmod +x "$DESKTOP_FILE"

echo "Successfully created launcher for $APP_NAME."
echo "You may need to refresh your application menu to see it."
